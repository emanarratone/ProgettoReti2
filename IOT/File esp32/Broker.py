import umqtt.simple as mqttimport ubinasciiimport ujsonfrom machine import unique_idclass MQTTBroker:    def __init__(self, broker='10.187.40.129', port=1883):        self.broker = broker        self.port = port        self.client_id = ubinascii.hexlify(unique_id())        self.client = None    def connect(self):        try:            self.client = mqtt.MQTTClient(self.client_id, self.broker, port=self.port, keepalive=60)            self.client.connect()            print(f"Connesso al broker: {self.broker}")            return 1        except Exception as e:            print(f"Errore connessione MQTT: {e}")            return 0    def publish(self, topic, data):        if self.client:            try:                t = topic.encode() if isinstance(topic, str) else topic                # Se i dati sono gi√† una stringa o bytes, usiamoli cos√¨; altrimenti serializziamo il dict                if isinstance(data, (str, bytes)):                    msg = data                else:                    msg = ujson.dumps(data)                self.client.publish(t, msg)                print(f'üì§ Pubblicato su {topic}: {data}')                return True            except Exception as e:                print(f'‚ùå Publish fallito: {e}')        return False    def subscribe(self, topic):        if self.client:            self.client.subscribe(topic)            print(f"üì• Iscritto al topic: {topic}")    def set_callback(self, callback_func):        if self.client:            self.client.set_callback(callback_func)    def check_msg(self):        if self.client:            self.client.check_msg()    def scollegati(self):        if self.client:            self.client.disconnect()